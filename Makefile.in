##############################################################################
##
##    Makefile.in                     NQ                         Werner Nickel
##
##    $Id$
##

##
##    Values imported from the configure script
##
BINDIR=bin/@target@-@BASECC@
GAP_ROOT=$(PWD)/../..
GNU_MP_INC=.
GNU_MP_LIB=$(GNU_MP_INC)

WEB_DIR  = /www/homepages/nickel/software/NQ/
HTML_DOC = doc/chap0.html doc/chap1.html doc/chap2.html \\
	   doc/chap3.html doc/chap4.html doc/chap5.html \\
	   doc/chapBib.html doc/chapInd.html doc/manual.css \\
	   doc/nqman.pdf

all: compile

gap: compile gapmanual

compile:
	(cd src; make GNU_MP_LIB=$(GNU_MP_LIB) GNU_MP_INC=$(GNU_MP_INC))
	@if test ! -d bin;  then mkdir bin; fi
	@if test ! -d $(BINDIR);  then mkdir $(BINDIR); fi
	mv src/nq $(BINDIR)

gapmanual:
	@if test ! -r $(GAP_ROOT)/sysinfo.gap; then \
	    echo "";							  \
	    echo "    Cannot locate the (main) GAP root directory.";      \
	    echo "    Determine the directory first and then run";        \
	    echo "    make again with the GAP root directory specified."; \
	    echo "";							  \
	    echo "    usage: make [ GAP_ROOT=<gap-root>]";		  \
	    echo "";							  \
	    exit 1;                                                       \
	else                                                              \
	    (cd doc; make GAP_ROOT=$(GAP_ROOT))                           \
	fi

release-2.0:
	cvs export -D 'February 11, 2003 11:00' -d nq-2.0 GAP/4.0/pkg/nq

	find nq-2.0 -name .cvsignore -exec rm "{}" ";"

	rm -f nq-2_0.zoo nq-2_0.tgz nq-2_0.tar
	tar cf nq-2_0.tar nq-2.0
	find nq-2.0 -type f -exec zoo ah nq-2_0.zoo "{}" ";"
	gzip < nq-2_0.tar > nq-2_0.tgz

WWW:
	@echo 'Moving archive files'
	cp nq-2_0.tar nq-2_0.tgz nq-2_0.zoo $(WEB_DIR)
	@echo 'Preparing HTML manual'
	cp $(HTML_DOC) $(WEB_DIR)/doc
	tar cvzf $(WEB_DIR)/nqdoc.tar.gz -C $(WEB_DIR) doc
	@echo 'Preparing PDF- and PS-manuals'
	cp doc/manual.pdf $(WEB_DIR)/nqman.pdf
	cp doc/manual.ps $(WEB_DIR)/nqman.ps
	cp doc/manual.six $(WEB_DIR)/nqman.six
	@echo 'Copying Package info'
	cp PkgInfo.g $(WEB_DIR)

test:
	(cd examples; make)

clean:
	rm -f *~ */*~ config.cache config.log config.status
	(cd src;      make clean)
	(cd doc;      make clean)
	(cd examples; make clean)

spotless: clean
	rm -f Makefile
	rm -rf bin
	(cd src;      make spotless)
	(cd doc;      make spotless)
	(cd examples; make spotless)

