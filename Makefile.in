##############################################################################
##
##    Makefile.in                     NQ                         Werner Nickel
##
##    $Id$
##

##
##    Values imported from the configure script
##
top_srcdir = @top_srcdir@
top_builddir = @top_builddir@
srcdir = @srcdir@
VPATH = @srcdir@
subdir = .

GAP_ROOT=@GAP_ROOT@
BINDIR=bin/@GAP_ARCH@
GMP_CFLAGS=@GMP_CFLAGS@
GMP_LIBS=@GMP_LIBS@

CURRENT_VERSION=2.2
CURRENT_VER=2_2

WEB_DIR  = /www/homepages/nickel/software/NQ/
HTML_DOC = nq-$(CURRENT_VERSION)/doc/chap*.html \
	       nq-$(CURRENT_VERSION)/doc/manual.css  \
	       nq-$(CURRENT_VERSION)/doc/manual.pdf

all: compile

gap: compile gapmanual

compile:
	(cd src; make)
	mkdir -p $(BINDIR)
	mv src/nq $(BINDIR)

gapmanual:
	cd doc; make

release-2.0:
	cvs export -D 'February 11, 2003 11:00' -d nq-2.0 GAP/4.0/pkg/nq

	find nq-2.0 -name .cvsignore -exec rm "{}" ";"

	rm -f nq-2_0.zoo nq-2_0.tgz nq-2_0.tar
	tar cf nq-2_0.tar nq-2.0
	find nq-2.0 -type f -exec zoo ah nq-2_0.zoo "{}" ";"
	gzip < nq-2_0.tar > nq-2_0.tgz

release-2.1: clean
	cvs export -D 'October 20, 2003 11:00' -d nq-2.1 GAP/4.0/pkg/nq

	find nq-2.1 -name .cvsignore -exec rm "{}" ";"

	cd nq-2.1/doc; make; make clean

	rm -f nq-2_1.zoo nq-2_1.tgz nq-2_1.tar
	tar cf nq-2_1.tar nq-2.1
	find nq-2.1 -type f -exec zoo ah nq-2_1.zoo "{}" ";"
	gzip < nq-2_1.tar > nq-2_1.tgz

release-2.2: clean
	cvs export -D 'February 7, 2007 12:00' -d nq-2.2 GAP/4.0/pkg/nq

	find nq-2.2 -name .cvsignore -exec rm "{}" ";"

	cd nq-2.2/doc; make; make clean

	rm -f nq-2_2.zoo nq-2_2.tgz nq-2_2.tar
	tar cf nq-2_2.tar nq-2.2
	find nq-2.2 -type f -exec zoo ah nq-2_2.zoo "{}" ";"
	gzip < nq-2_2.tar > nq-2_2.tgz

WWW: release-$(CURRENT_VERSION)
	if [ ! -d $(WEB_DIR) ]; then mkdir $(WEB_DIR); fi

	@echo '--> Moving archive files'
	cp nq-$(CURRENT_VER).tar $(WEB_DIR)/nq.tar
	cp nq-$(CURRENT_VER).tgz $(WEB_DIR)/nq.tar.gz
	cp nq-$(CURRENT_VER).tgz $(WEB_DIR)/nq.tgz
	cp nq-$(CURRENT_VER).zoo $(WEB_DIR)/nq.zoo

	@echo 'Copying README file'
	cp README $(WEB_DIR) 

	@echo '--> Preparing HTML manual'
	if [ ! -d $(WEB_DIR)/doc ]; then mkdir $(WEB_DIR)/doc; fi
	cp $(HTML_DOC) $(WEB_DIR)/doc

	@echo '--> Preparing PDF- and PS-manuals'
	cp nq-$(CURRENT_VERSION)/doc/manual.pdf $(WEB_DIR)/nqman.pdf
	cp nq-$(CURRENT_VERSION)/doc/manual.ps $(WEB_DIR)/nqman.ps
	cp nq-$(CURRENT_VERSION)/doc/manual.six $(WEB_DIR)/nqman.six
	@echo '--> Copying Package info'
	cp PackageInfo.g $(WEB_DIR)

test:
	(cd examples; make)

clean:
	(cd src;      make clean)
	(cd doc;      make clean)
	(cd examples; make clean)

distclean: clean
	rm -f Makefile
	rm -rf bin
	rm -rf .\#*
	rm -f *~ */*~
	rm -rf nq-2.? nq-2_?.tar nq-2_?.tgz nq-2_?.zoo
	rm -f config.cache config.log config.status
	(cd src;      make distclean)
	(cd doc;      make distclean)
	(cd examples; make distclean)


.PRECIOUS: Makefile
Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@

.PHONY: all gap compile gapmanual WWW test clean distclean
